import { Meta, Story, Canvas, ArgsTable, Source } from '@storybook/addon-docs';
import { InputSearch, Form } from '../../..';
import dedent from 'string-dedent';
import './input-search-story.css';

<Meta title="Components/Inputs/Input Search" component={InputSearch} />

# Input Search

<Canvas>
  <Story
    name="Input Search"
    parameters={{
      docs: {
        source: {
          code: dedent`
          <Form
            initialValues={{
              search: undefined or search value (must be exact match)
            }}
            onSubmit={() => {}}
          >
            {formikProps => (
              <>
                <p className="lc-mb-8">Selected Abstract: {\`\${JSON.stringify(formikProps.values.search?.abstract)}\`}</p>
                <InputSearch
                  label="Search Option"
                  name="search"
                  url="https://api.nytimes.com/svc/search/v2/articlesearch.json?api-key=WymYNTjhumX7gEql9RMCAk9nopWwQVKG"
                  searchParam="q"
                  optionLabelKey="headline.main"
                  getOptions={response => response?.response?.docs || []}
                  autocompleteConfig={{
                    noOptionsText: \`Please try again in a minute, NYT Rate Limits their APIs to 10 requests per minute.\`,
                    loadingText: \`Type to search...\`
                  }}
                  formikProps={formikProps}
                />
              </>
            )}
          </Form>`
        }
      }
    }}
  >
    <div className="input-search-story">
      <Form
        formConfig={{ safeName: true }}
        initialValues={{
          'search[test]': {
            abstract: 'Lance Bass of ’N Sync fame buys an apartment at the Chelsea Mercantile.',
            web_url: 'https://www.nytimes.com/2010/05/09/realestate/09deal3.html',
            snippet: 'Lance Bass of ’N Sync fame buys an apartment at the Chelsea Mercantile.',
            lead_paragraph:
              'WHO remembers that catchy ’N Sync song “Bye, Bye, Bye?” Turns out a former band member, Lance Bass, has decided to buy, buy, buy a condo at the Chelsea Mercantile.',
            print_section: 'RE',
            print_page: '2',
            source: 'The New York Times',
            multimedia: [
              {
                rank: 0,
                subtype: 'popup',
                caption: null,
                credit: null,
                type: 'image',
                url: 'images/2010/05/09/realestate/09deal3_CA0/09deal3_CA0-popup.jpg',
                height: 500,
                width: 400,
                legacy: {},
                subType: 'popup',
                crop_name: 'popup'
              },
              {
                rank: 0,
                subtype: 'articleInline',
                caption: null,
                credit: null,
                type: 'image',
                url: 'images/2010/05/09/realestate/09deal3_CA0/09deal3_CA0-articleInline.jpg',
                height: 235,
                width: 190,
                legacy: {},
                subType: 'articleInline',
                crop_name: 'articleInline'
              },
              {
                rank: 0,
                subtype: 'thumbnail',
                caption: null,
                credit: null,
                type: 'image',
                url: 'images/2010/05/09/realestate/09deal3_CA0/09deal3_CA0-thumbStandard.jpg',
                height: 75,
                width: 75,
                legacy: {
                  thumbnail: 'images/2010/05/09/realestate/09deal3_CA0/09deal3_CA0-thumbStandard.jpg',
                  thumbnailwidth: 75,
                  thumbnailheight: 75
                },
                subType: 'thumbnail',
                crop_name: 'thumbStandard'
              }
            ],
            headline: {
              main: '',
              kicker: 'Big Deal',
              content_kicker: null,
              print_headline: 'Hi, Hi, Hi for a New Neighbor',
              name: null,
              seo: null,
              sub: null
            },
            keywords: [
              {
                name: 'persons',
                value: 'Bass, Lance',
                rank: 1,
                major: 'N'
              },
              {
                name: 'subject',
                value: 'Housing and Real Estate',
                rank: 2,
                major: 'N'
              }
            ],
            pub_date: '2010-05-07T19:03:03+0000',
            news_desk: 'RealEstate',
            section_name: 'Real Estate',
            byline: {
              original: 'By Elizabeth A. Harris',
              person: [
                {
                  firstname: 'Elizabeth',
                  middlename: 'A.',
                  lastname: 'Harris',
                  qualifier: null,
                  title: null,
                  role: 'reported',
                  organization: '',
                  rank: 1
                }
              ],
              organization: null
            },
            _id: 'nyt://article/ead1fd2a-3be7-52df-b21d-eb8f0a25a005',
            word_count: 151,
            uri: 'nyt://article/ead1fd2a-3be7-52df-b21d-eb8f0a25a005'
          }
        }}
        onSubmit={() => {}}
      >
        {formikProps => (
          <>
            <p className="lc-mb-8">
              Selected Abstract: {`${JSON.stringify(formikProps.values['search[test]']?.abstract)}`}
            </p>
            <InputSearch
              label="Search Option"
              name="search[test]"
              url="https://api.nytimes.com/svc/search/v2/articlesearch.json?api-key=WymYNTjhumX7gEql9RMCAk9nopWwQVKG"
              searchParam="q"
              optionLabelKey="headline.main"
              getOptions={response => response?.response?.docs || []}
              searchOptions={{ initialSearchValue: '', ignoreFalseyInputValues: false }}
              autocompleteConfig={{
                autoHighlight: false,
                noOptionsText: `Please try again in a minute, NYT Rate Limits their APIs to 10 requests per minute.`,
                loadingText: `Type to search...`,
                filterOptions: x => x
              }}
              formikProps={formikProps}
            />
          </>
        )}
      </Form>
    </div>
  </Story>
  <ArgsTable of={InputSearch} />
</Canvas>
